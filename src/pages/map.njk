---
layout: base.njk
title: Spot Map ‚Äî Skate And the City
metaDescription: Interactive map of every skate spot, shop, and food place in NYC.
permalink: /map/
---
<style>
  /* Override main container for full-width map */
  main.flex-1 { max-width: 100% !important; padding: 0 !important; }
  #map { width: 100%; height: calc(100vh - 56px - 52px); min-height: 400px; }

  /* Filter panel */
  .filter-panel {
    position: absolute; top: 10px; right: 10px; z-index: 1000;
    background: #16213e; border: 1px solid rgba(229,62,62,.4); border-radius: 8px;
    padding: 12px 16px; min-width: 200px; color: #e0e0e0; font-size: 13px;
    max-height: 80vh; overflow-y: auto;
  }
  .filter-panel h3 { margin: 0 0 8px; font-size: 14px; font-weight: 600; color: #e53e3e; }
  .filter-group { margin-bottom: 10px; }
  .filter-group label { display: block; margin-bottom: 2px; cursor: pointer; }
  .filter-group label input { margin-right: 6px; }
  .filter-toggle {
    position: absolute; top: 10px; right: 10px; z-index: 1001;
    background: #16213e; border: 1px solid rgba(229,62,62,.4); border-radius: 6px;
    color: #e53e3e; padding: 6px 12px; cursor: pointer; font-size: 13px; display: none;
  }

  /* Popup styling */
  .spot-popup { font-family: inherit; }
  .spot-popup h4 { margin: 0 0 4px; font-size: 15px; }
  .spot-popup .type-badge {
    display: inline-block; padding: 1px 8px; border-radius: 10px;
    font-size: 11px; color: #fff; margin-bottom: 4px;
  }
  .spot-popup .stars { color: #f6ad55; }
  .spot-popup .status { font-size: 12px; margin: 4px 0; }
  .spot-popup .status.active { color: #48bb78; }
  .spot-popup .status.restricted { color: #ed8936; }
  .spot-popup .status.demolished { color: #e53e3e; }
  .spot-popup a { color: #e53e3e; text-decoration: underline; font-size: 12px; }

  /* Locate button */
  .locate-btn {
    position: absolute; bottom: 30px; right: 10px; z-index: 1000;
    background: #16213e; border: 1px solid rgba(229,62,62,.4); border-radius: 50%;
    width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 20px; color: #e53e3e;
  }
  .locate-btn:hover { background: #1a1a2e; }
</style>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

<div style="position:relative;">
  <div id="map"></div>

  <div class="filter-panel" id="filterPanel">
    <h3>üîç Filters</h3>
    <div class="filter-group">
      <strong>Type</strong>
      <label><input type="checkbox" class="filter-type" value="street" checked> üî¥ Street</label>
      <label><input type="checkbox" class="filter-type" value="park" checked> üü¢ Park</label>
      <label><input type="checkbox" class="filter-type" value="DIY" checked> üü† DIY</label>
      <label><input type="checkbox" class="filter-type" value="plaza" checked> üîµ Plaza</label>
    </div>
    <div class="filter-group">
      <strong>Borough</strong>
      <label><input type="checkbox" class="filter-borough" value="Manhattan" checked> Manhattan</label>
      <label><input type="checkbox" class="filter-borough" value="Brooklyn" checked> Brooklyn</label>
      <label><input type="checkbox" class="filter-borough" value="Queens" checked> Queens</label>
      <label><input type="checkbox" class="filter-borough" value="Bronx" checked> Bronx</label>
      <label><input type="checkbox" class="filter-borough" value="Staten Island" checked> Staten Island</label>
    </div>
    <div class="filter-group">
      <strong>Difficulty</strong>
      <label><input type="checkbox" class="filter-diff" value="1" checked> ‚≠ê Beginner</label>
      <label><input type="checkbox" class="filter-diff" value="2" checked> ‚≠ê‚≠ê Intermediate</label>
      <label><input type="checkbox" class="filter-diff" value="3" checked> ‚≠ê‚≠ê‚≠ê Advanced</label>
      <label><input type="checkbox" class="filter-diff" value="4" checked> ‚≠ê‚≠ê‚≠ê‚≠ê Expert</label>
    </div>
    <div class="filter-group">
      <strong>Layers</strong>
      <label><input type="checkbox" id="toggleShops" checked> üõπ Shops</label>
      <label><input type="checkbox" id="toggleFood" checked> üçï Food</label>
    </div>
    <button onclick="document.getElementById('filterPanel').style.display='none';document.getElementById('filterToggle').style.display='block';"
      style="background:none;border:none;color:#999;cursor:pointer;font-size:11px;padding:0;">Hide filters</button>
  </div>

  <button class="filter-toggle" id="filterToggle" onclick="this.style.display='none';document.getElementById('filterPanel').style.display='block';">
    üîç Filters
  </button>

  <button class="locate-btn" id="locateBtn" title="Find my location">üìç</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script>
(async function() {
  const map = L.map('map').setView([40.7128, -74.006], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '¬© OpenStreetMap contributors',
    maxZoom: 19
  }).addTo(map);

  const typeColors = { street: '#e53e3e', park: '#48bb78', DIY: '#ed8936', plaza: '#4299e1', transition: '#9f7aea' };

  function makeIcon(type) {
    const color = typeColors[type] || '#999';
    return L.divIcon({
      className: '',
      html: `<div style="width:14px;height:14px;border-radius:50%;background:${color};border:2px solid #fff;box-shadow:0 1px 4px rgba(0,0,0,.4);"></div>`,
      iconSize: [14, 14], iconAnchor: [7, 7]
    });
  }

  function starsHtml(n) { return '‚≠ê'.repeat(n); }

  function statusHtml(s) {
    const cls = s === 'active' ? 'active' : s === 'restricted' ? 'restricted' : 'demolished';
    const icon = s === 'active' ? 'üü¢' : s === 'restricted' ? 'üü°' : 'üî¥';
    return `<div class="status ${cls}">${icon} ${s.charAt(0).toUpperCase()+s.slice(1)}</div>`;
  }

  const resp = await fetch('/skate-and-the-city/data/spots.json');
  const spots = await resp.json();

  const clusterGroup = L.markerClusterGroup({ disableClusteringAtZoom: 13 });
  const markers = [];

  spots.forEach(spot => {
    const marker = L.marker([spot.coordinates.lat, spot.coordinates.lng], { icon: makeIcon(spot.type) });
    marker._spotData = spot;
    const badgeColor = typeColors[spot.type] || '#999';
    marker.bindPopup(`
      <div class="spot-popup">
        <h4>${spot.name}</h4>
        <span class="type-badge" style="background:${badgeColor}">${spot.type}</span>
        <div class="stars">${starsHtml(spot.difficulty)}</div>
        ${statusHtml(spot.status)}
        <p style="font-size:12px;margin:4px 0;color:#666;">${spot.description.slice(0,120)}${spot.description.length>120?'‚Ä¶':''}</p>
        <a href="/spots/#${spot.id}">View Details ‚Üí</a>
      </div>
    `, { maxWidth: 280 });
    markers.push(marker);
    clusterGroup.addLayer(marker);
  });

  map.addLayer(clusterGroup);

  // Shop & Food layers
  const shopLayer = L.layerGroup();
  const foodLayer = L.layerGroup();

  const shopIcon = L.divIcon({ className: '', html: '<div style="font-size:20px;text-align:center;">üõπ</div>', iconSize: [28, 28], iconAnchor: [14, 14] });
  const foodIcon = L.divIcon({ className: '', html: '<div style="font-size:20px;text-align:center;">üçï</div>', iconSize: [28, 28], iconAnchor: [14, 14] });

  fetch('/skate-and-the-city/data/shops.json').then(r=>r.json()).then(shops => {
    shops.forEach(shop => {
      const m = L.marker([shop.coordinates.lat, shop.coordinates.lng], { icon: shopIcon });
      m.bindPopup(`<div class="spot-popup"><h4>${shop.name}</h4><p style="font-size:12px;margin:4px 0;color:#666;">${shop.address}</p><a href="/shops/${shop.id}/">View Details ‚Üí</a></div>`, { maxWidth: 280 });
      shopLayer.addLayer(m);
    });
    shopLayer.addTo(map);
  });

  fetch('/skate-and-the-city/data/food.json').then(r=>r.json()).then(foods => {
    foods.forEach(item => {
      const m = L.marker([item.coordinates.lat, item.coordinates.lng], { icon: foodIcon });
      m.bindPopup(`<div class="spot-popup"><h4>${item.name}</h4><p style="font-size:12px;margin:4px 0;color:#666;">${item.cuisine} ¬∑ ${item.priceRange}</p><a href="/food/${item.id}/">View Details ‚Üí</a></div>`, { maxWidth: 280 });
      foodLayer.addLayer(m);
    });
    foodLayer.addTo(map);
  });

  document.getElementById('toggleShops').addEventListener('change', function() {
    this.checked ? map.addLayer(shopLayer) : map.removeLayer(shopLayer);
  });
  document.getElementById('toggleFood').addEventListener('change', function() {
    this.checked ? map.addLayer(foodLayer) : map.removeLayer(foodLayer);
  });

  // Filtering
  function applyFilters() {
    const types = [...document.querySelectorAll('.filter-type:checked')].map(c => c.value);
    const boroughs = [...document.querySelectorAll('.filter-borough:checked')].map(c => c.value);
    const diffs = [...document.querySelectorAll('.filter-diff:checked')].map(c => parseInt(c.value));

    clusterGroup.clearLayers();
    markers.forEach(m => {
      const s = m._spotData;
      if (types.includes(s.type) && boroughs.includes(s.borough) && diffs.includes(s.difficulty)) {
        clusterGroup.addLayer(m);
      }
    });
  }

  document.querySelectorAll('.filter-type, .filter-borough, .filter-diff').forEach(cb => {
    cb.addEventListener('change', applyFilters);
  });

  // Locate me
  document.getElementById('locateBtn').addEventListener('click', () => {
    if (!navigator.geolocation) return alert('Geolocation not supported');
    navigator.geolocation.getCurrentPosition(pos => {
      const { latitude, longitude } = pos.coords;
      map.setView([latitude, longitude], 15);
      L.marker([latitude, longitude], {
        icon: L.divIcon({
          className: '',
          html: '<div style="width:18px;height:18px;border-radius:50%;background:#4299e1;border:3px solid #fff;box-shadow:0 0 8px rgba(66,153,225,.6);"></div>',
          iconSize: [18, 18], iconAnchor: [9, 9]
        })
      }).addTo(map).bindPopup('You are here').openPopup();
    }, () => alert('Could not get your location'));
  });
})();
</script>
